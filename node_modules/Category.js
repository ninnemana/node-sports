var http = require('http');
var Category = function(){

}

Category.getParents = function(callback){
	var options = {
		host: 'api.curtmfg.com',
		path: '/v2/GetParentCategories?dataType=json'
	};
	http.get(options, function(res){
		var str = '';
		res.on('data',function(chunk){
			str += chunk;
		});

		res.on('end',function(){
			var catList = JSON.parse(str);
			callback(catList);
		})
	}).on('error',function(e){
		console.log("Got error: " + e.message);
		callback('[]');
	});
	
}

Category.getSubs = function(id, callback){
	var options = {
		host: 'api.curtmfg.com',
		path: '/v2/GetCategories?dataType=json&parentID=' + id,
	};
	http.get(options, function(res){
		var str = '';
		res.on('data',function(chunk){
			str += chunk;
		});

		res.on('end',function(){
			var catList = JSON.parse(str);
			callback(catList);
		})
	}).on('error',function(e){
		console.log("Got error: " + e.message);
		callback('[]');
	});
	
}

Category.get = function(id, callback){
	if(id == undefined || id == 0){
		callback('[]');
	}else{
		var options = {
			host: 'api.curtmfg.com',
			path: '/v2/GetCategory?dataType=json&catID=' + id
		};
		http.get(options, function(res){
			var str = '';
			res.on('data',function(chunk){
				str += chunk;
			});

			res.on('end',function(){
				var c = JSON.parse(str);
				var cat = c.parent;
				cat.content = c.content;
				cat.sub_categories = c.sub_categories;
				callback(cat);
			});

			res.on('error',function(){
				callback('[]');
			});
		}).on('error',function(e){
			console.log("Got error: " + e.message);
			callback();
		});
	}
}

Category.getParts = function(id, page, count, callback){
	var options = {
		host: 'api.curtmfg.com',
		path: '/v2/GetCategoryParts?dataType=json&catID=' + id + '&page=' + page + '&perpage=' + count,
	};
	http.get(options, function(res){
		var str = '';
		res.on('data',function(chunk){
			str += chunk;
		});

		res.on('end',function(){
			var partList = JSON.parse(str);
			callback(partList);
		})
	}).on('error',function(e){
		console.log("Got error: " + e.message);
		callback('[]');
	});
}

Category.getBreadcrumbs = function(id, callback){
	var options = {
		host: 'api.curtmfg.com',
		path: '/v2/GetCategoryBreadcrumbs?dataType=json&catID=' + id,
	};
	http.get(options, function(res){
		var str = '';
		res.on('data',function(chunk){
			str += chunk;
		});

		res.on('end',function(){
			var catList = JSON.parse(str);
			callback(catList);
		})
	}).on('error',function(e){
		console.log("Got error: " + e.message);
		callback('[]');
	});
}

module.exports.Category = Category;